---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import AudioshowPost from "../components/AudioshowPost.astro";

const allPosts = await getCollection("audioshow");
const posts = allPosts.sort(
	(a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime(),
);
const latestEpisode = posts[0];
const archive = posts.slice(1);
const headTitle = "Audioshow";
const pageTitle = "Audioshow";
const lede =
	"A hand-built radio diary — 200 episodes of quotes, riffs, and late-night selections.";
const favorites = [
	{
		title: "From Zero",
		artist: "Linkin Park",
		link: "https://music.apple.com/album/from-zero/1766137049",
		notes: "Unreleased demos from my teenage hard drive.",
	},
	{
		title: "Me Against the World",
		artist: "2Pac",
		link: "https://music.apple.com/album/me-against-the-world/1440509542",
		notes: "Poetry, paranoia, and perfect percussion.",
	},
	{
		title: "American Beauty",
		artist: "Grateful Dead",
		link: "https://music.apple.com/album/american-beauty/664831661",
		notes: "Acoustic sunshine for desk-bound nights.",
	},
];
---

<BaseLayout pageTitle={pageTitle} headTitle={headTitle} lede={lede}>
	<section class="audio-hero">
		<div>
			<p class="eyebrow">What is Audioshow?</p>
			<p>
				A weekly set of six songs wrapped in a lyric, a quote, or a
				sample. Each entry is one PNG poster plus Markdown notes —
				portable, light, and friendly to RSS.
			</p>
			<ul class="list-reset meta-line inline">
				<li>200+ episodes since 2022</li>
				<li>Rock, hip-hop, prog, ambient</li>
				<li>Recorded midnight, published at dawn</li>
			</ul>
		</div>
		<img
			src="/images/audioshow/audioshow.png"
			alt="Audioshow badge"
			class="audio-badge"
			loading="lazy"
		/>
	</section>

	{
		latestEpisode && (
			<section>
				<p class="eyebrow">Latest episode</p>
				<article class="latest-card surface-card">
					<p class="pill">EP {latestEpisode.data.episode}</p>
					<h2>{latestEpisode.data.title}</h2>
					<p class="muted">
						{latestEpisode.data.pubDate.toLocaleDateString("en", {
							month: "long",
							day: "numeric",
							year: "numeric",
						})}
					</p>
					<p>
						{latestEpisode.data.description ??
							"Fresh from the midnight session."}
					</p>
					<a
						class="cta-link"
						href={`/audioshow/${latestEpisode.slug}/`}
					>
						Listen / read notes ↗
					</a>
				</article>
			</section>
		)
	}

	<section>
		<p class="eyebrow">Featured selections</p>
		<ul class="list-reset favorite-list">
			{
				favorites.map((pick) => (
					<li class="surface-card">
						<a
							href={pick.link}
							target="_blank"
							rel="noopener noreferrer"
						>
							<strong>{pick.title}</strong> — {pick.artist}
						</a>
						<p class="muted">{pick.notes}</p>
					</li>
				))
			}
		</ul>
	</section>

	<section>
		<p class="eyebrow">Episode archive</p>
		<ul class="list-reset grid-auto">
			{
				archive.map((post) => (
					<AudioshowPost
						url={`/audioshow/${post.slug}/`}
						episode={post.data.episode}
						pubDate={post.data.pubDate}
						title={post.data.title}
					/>
				))
			}
		</ul>
		<img
			src="/images/audioshow/audioshow_poster.png"
			alt="Audioshow poster"
			class="audio-poster"
			loading="lazy"
		/>
	</section>
</BaseLayout>

<style>
	.latest-card {
		padding: 2.5rem;
	}

	.audio-badge {
		max-width: 320px;
		margin: 0 auto;
	}
</style>
