---
import BaseLayout from "../../layouts/BaseLayout.astro";

const allPosts = await Astro.glob("../posts/*/*.md");
const tagMap = allPosts.reduce((acc, post) => {
	(post.frontmatter.tags ?? []).forEach((tag) => {
		acc[tag] = (acc[tag] ?? 0) + 1;
	});
	return acc;
}, {});
const tags = Object.entries(tagMap).sort((a, b) => b[1] - a[1]);
const pageTitle = "Tags";
const lede = "Browse every topic covered on the blog â€” math, ML, photography, and playlists.";
---

<BaseLayout pageTitle={pageTitle} headTitle="Tags" lede={lede}>
	<section class="tag-board">
		{tags.map(([tag, count]) => (
			<a href={`/tags/${tag}`} class="surface-card">
				<strong>{tag}</strong>
				<span>{count} posts</span>
			</a>
		))}
	</section>
</BaseLayout>

<style>
	.tag-board {
		display: grid;
		gap: 0.8rem;
		grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
	}

	.tag-board a {
		text-decoration: none;
		display: flex;
		flex-direction: column;
		gap: 0.35rem;
	}

	.tag-board span {
		color: var(--text-muted);
		font-size: 0.85rem;
	}
</style>
