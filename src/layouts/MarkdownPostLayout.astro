---
import BaseLayout from "./BaseLayout.astro";
import "../style/post.css";

const { frontmatter } = Astro.props;

const formattedDate = frontmatter.pubDate
	? new Date(frontmatter.pubDate).toLocaleDateString("en", {
			year: "numeric",
			month: "long",
			day: "numeric",
		})
	: "";

const tags = Array.isArray(frontmatter.tags) ? frontmatter.tags : [];

// Estimate reading time (rough: 200 words per minute for mixed content)
const content = Astro.props.compiledContent?.() ?? "";
const wordCount = content.split(/\s+/).length;
const readingTime = Math.max(1, Math.ceil(wordCount / 200));
---

<BaseLayout
	pageTitle={frontmatter.title}
	headTitle={frontmatter.title}
	hideHeading={true}
>
	<article class="post">
		<header class="post-header">
			{
				tags.length > 0 && (
					<ul class="list-reset tag-row">
						{tags.map((tag) => (
							<li>
								<a href={`/tags/${tag}`}>{tag}</a>
							</li>
						))}
					</ul>
				)
			}

			<h1>{frontmatter.title}</h1>

			{
				frontmatter.description && (
					<p class="lede">{frontmatter.description}</p>
				)
			}

			<div class="meta-line">
				{formattedDate && <span>{formattedDate}</span>}
				{frontmatter.author && <span>by {frontmatter.author}</span>}
				<span>{readingTime} min read</span>
			</div>

			{
				frontmatter.image?.url && (
					<figure class="post-cover">
						<img
							src={frontmatter.image.url}
							alt={frontmatter.image.alt ?? frontmatter.title}
							loading="lazy"
						/>
						{frontmatter.image.alt && (
							<figcaption>{frontmatter.image.alt}</figcaption>
						)}
					</figure>
				)
			}
		</header>

		<div class="post-content">
			<slot />
		</div>
	</article>
</BaseLayout>
